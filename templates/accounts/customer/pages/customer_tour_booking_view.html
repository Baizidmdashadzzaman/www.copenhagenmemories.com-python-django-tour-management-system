{% extends 'accounts/customer/layout.html' %}

{% block customer_content %}
{% load static %}
{% load translate_tags %}

<div class="card border-0 shadow-sm print-card">
    <div class="card-header bg-white d-flex justify-content-between align-items-center py-3 border-bottom">
        <div>
            <h5 class="mb-1">{% translate "Booking #" %}{{ booking.booking_number }}</h5>
            <span class="text-muted fs-14">{% translate "Booked on" %} {{ booking.created_at|date:"d M, Y H:i" }}</span>
        </div>
        <div class="d-flex align-items-center gap-2">
            {% if booking.status == 'confirmed' %}
            <span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3">{% translate "Confirmed" %}</span>
            {% elif booking.status == 'pending' %}
            <span class="badge bg-warning-subtle text-warning border border-warning-subtle rounded-pill px-3">{% translate "Pending" %}</span>
            {% elif booking.status == 'cancelled' %}
            <span class="badge bg-danger-subtle text-danger border border-danger-subtle rounded-pill px-3">{% translate "Cancelled" %}</span>
            {% elif booking.status == 'completed' %}
            <span class="badge bg-info-subtle text-info border border-info-subtle rounded-pill px-3">{% translate "Completed" %}</span>
            {% else %}
            <span class="badge bg-secondary-subtle text-secondary border border-secondary-subtle rounded-pill px-3">{{ booking.status|title }}</span>
            {% endif %}
            
            <button onclick="window.print()" class="btn btn-outline-primary btn-sm rounded-pill d-print-none">
                <i class="isax isax-printer me-1"></i> {% translate "Print Invoice" %}
            </button>
        </div>
    </div>
    <div class="card-body">
        
        <!-- Tour Details -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3 mb-md-0 d-print-none">
                {% if booking.tour.main_image %}
                <img src="{{ booking.tour.main_image.url }}" alt="{{ booking.tour.title }}" class="img-fluid rounded object-fit-cover w-100" style="height: 150px;">
                {% else %}
                <img src="{% static 'frontend/assets/img/tours/default-tour.jpg' %}" alt="{{ booking.tour.title }}" class="img-fluid rounded object-fit-cover w-100" style="height: 150px;">
                {% endif %}
            </div>
            <div class="col-md-9">
                <h5 class="mb-2"><a href="{% url 'tour_detail' booking.tour.id %}" class="text-dark">{{ booking.tour.title }}</a></h5>
                
                <div class="row g-3 text-muted fs-14">
                    <div class="col-sm-6 col-md-4">
                        <div class="d-flex align-items-center mb-1">
                            <i class="isax isax-calendar-1 me-2 text-primary"></i> 
                            <span>{% translate "Tour Date" %}</span>
                        </div>
                        <span class="fw-medium text-dark ms-4">{{ booking.tour_date|date:"d M, Y" }}</span>
                    </div>
                    {% if booking.tour_time %}
                    <div class="col-sm-6 col-md-4">
                        <div class="d-flex align-items-center mb-1">
                            <i class="isax isax-clock me-2 text-primary"></i>
                            <span>{% translate "Start Time" %}</span>
                        </div>
                        <span class="fw-medium text-dark ms-4">{{ booking.tour_time|time:"H:i" }}</span>
                    </div>
                    {% endif %}
                    <div class="col-sm-6 col-md-4">
                         <div class="d-flex align-items-center mb-1">
                            <i class="isax isax-location me-2 text-primary"></i>
                            <span>{% translate "Location" %}</span>
                        </div>
                        <span class="fw-medium text-dark ms-4">
                             {% if booking.tour.city %}{{ booking.tour.city.name }}, {% endif %}
                             {% if booking.tour.destination_region %}{{ booking.tour.destination_region.name }}{% endif %}
                        </span>
                    </div>
                    <div class="col-sm-6 col-md-4">
                        <div class="d-flex align-items-center mb-1">
                           <i class="isax isax-people me-2 text-primary"></i>
                           <span>{% translate "Participants" %}</span>
                       </div>
                       <span class="fw-medium text-dark ms-4">{{ booking.total_participants }} Person(s)</span>
                   </div>
                     <div class="col-sm-6 col-md-4">
                        <div class="d-flex align-items-center mb-1">
                           <i class="isax isax-timer-1 me-2 text-primary"></i>
                           <span>{% translate "Duration" %}</span>
                       </div>
                       <span class="fw-medium text-dark ms-4">{{ booking.tour.duration_text|default:"N/A" }}</span>
                   </div>
                </div>
            </div>
        </div>

        <hr class="my-4 border-dashed">

        <div class="row">
            <!-- Customer Details -->
            <div class="col-md-6 mb-4">
                <h6 class="mb-3 text-uppercase fs-13 text-muted fw-bold ls-1">{% translate "Customer Information" %}</h6>
                <div class="p-3 bg-light rounded">
                    <div class="mb-2">
                        <span class="text-muted fs-14">{% translate "Name" %}</span>
                        <span class="fw-medium ms-2 text-dark">{{ booking.contact_name }}</span>
                    </div>
                    <div class="mb-2">
                        <span class="text-muted fs-14">{% translate "Email" %}</span>
                        <span class="fw-medium ms-2 text-dark">{{ booking.contact_email }}</span>
                    </div>
                     <div class="mb-2">
                        <span class="text-muted fs-14">{% translate "Phone" %}</span>
                        <span class="fw-medium ms-2 text-dark">{{ booking.contact_phone }}</span>
                    </div>
                    {% if booking.pickup_location %}
                    <div class="mb-0">
                        <span class="text-muted fs-14">{% translate "Pickup Location" %}</span>
                        <span class="fw-medium ms-2 text-dark">{{ booking.pickup_location }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Payment Summary -->
             <div class="col-md-6 mb-4">
                <h6 class="mb-3 text-uppercase fs-13 text-muted fw-bold ls-1">{% translate "Payment Summary" %}</h6>
                <div class="border rounded p-3">
                    <div class="d-flex justify-content-between mb-2 fs-14">
                        <span class="text-muted">{% translate "Subtotal" %}</span>
                        <span class="fw-medium">{{ booking.currency }} {{ booking.subtotal }}</span>
                    </div>
                    {% if booking.discount_amount > 0 %}
                    <div class="d-flex justify-content-between mb-2 fs-14 text-success">
                        <span>{% translate "Discount" %}</span>
                        <span>- {{ booking.currency }} {{ booking.discount_amount }}</span>
                    </div>
                    {% endif %}
                    {% if booking.tax_amount > 0 %}
                    <div class="d-flex justify-content-between mb-2 fs-14">
                        <span class="text-muted">{% translate "Tax / VAT" %}</span>
                        <span>{{ booking.currency }} {{ booking.tax_amount }}</span>
                    </div>
                    {% endif %}
                    <div class="d-flex justify-content-between pt-2 border-top mt-2">
                        <span class="fw-bold fs-16 text-dark">{% translate "Total Amount" %}</span>
                        <span class="fw-bold fs-16 text-primary">{{ booking.currency }} {{ booking.total_amount }}</span>
                    </div>
                     <div class="mt-2 text-end">
                         {% if booking.payment_status == 'paid' %}
                         <span class="badge bg-success-subtle text-success">{% translate "Paid" %}</span>
                         {% elif booking.payment_status == 'pending' %}
                         <span class="badge bg-warning-subtle text-warning">{% translate "Payment Pending" %}</span>
                          {% elif booking.payment_status == 'refunded' %}
                         <span class="badge bg-info-subtle text-info">{% translate "Refunded" %}</span>
                         {% else %}
                         <span class="badge bg-secondary-subtle text-secondary">{{ booking.payment_status|title }}</span>
                         {% endif %}
                     </div>
                </div>
            </div>
        </div>
        
        <!-- Participant Details -->
        {% if booking.participants.all %}
        <div class="mb-0">
            <h6 class="mb-3 text-uppercase fs-13 text-muted fw-bold ls-1">{% translate "Participant Details" %}</h6>
            <div class="table-responsive border rounded">
                <table class="table table-sm table-striped mb-0 fs-14">
                    <thead class="bg-light">
                        <tr>
                            <th class="ps-3">{% translate "Name" %}</th>
                            <th>{% translate "Type" %}</th>
                            <th>{% translate "Age" %}</th>
                             <th class="pe-3 text-end">{% translate "Price" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for participant in booking.participants.all %}
                        <tr>
                            <td class="ps-3">{{ participant.first_name }} {{ participant.last_name }}</td>
                            <td>{{ participant.participant_type|title }}</td>
                            <td>{{ participant.age|default:"-" }}</td>
                             <td class="pe-3 text-end">{{ booking.currency }} {{ participant.price }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}
        
    </div>
    <div class="card-footer bg-light py-3 d-flex justify-content-between align-items-center d-print-none">
        <a href="{% url 'customer_my_bookings' %}" class="btn btn-light border btn-sm rounded-pill">
            <i class="isax isax-arrow-left-2 me-1"></i> {% translate "Back to List" %}
        </a>
        <a href="{% url 'contactus' %}" class="text-primary fs-14 text-decoration-underline">{% translate "Need Help? Contact Support" %}</a>
    </div>
</div>

<style type="text/css" media="print">
    @page { size: auto;  margin: 0mm; }
    body { background-color: #fff; }
    .header, .footer, .sidebar, .breadcrumb-bar, .user-sidebar, .d-print-none { display: none !important; }
    .content { padding: 20px !important; margin: 0 !important; }
    .container { max-width: 100% !important; width: 100% !important; padding: 0 !important; margin: 0 !important; }
    .col-xl-9, .col-lg-8 { width: 100% !important; flex: 0 0 100% !important; max-width: 100% !important; }
    .print-card { box-shadow: none !important; border: none !important; }
    .card-header { border-bottom: 2px solid #ddd !important; }
</style>

{% endblock %}