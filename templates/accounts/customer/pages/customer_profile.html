{% extends 'accounts/customer/layout.html' %}

{% block customer_content %}
{% load static %}

<div class="card border-0 shadow-sm">
    <div class="card-header bg-white py-3 border-bottom">
        <h5 class="mb-0">My Profile Settings</h5>
    </div>
    <div class="card-body">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            {% if messages %}
                <div class="messages mb-4">
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    {% endfor %}
                </div>
            {% endif %}

            <div class="row align-items-center mb-4">
                <div class="col-auto">
                    <div class="avatar avatar-xxl position-relative">
                         {% if user.customer_profile.profile_image %}
                        <img src="{{ user.customer_profile.profile_image.url }}" alt="profile" class="rounded-circle object-fit-cover w-100 h-100">
                        {% else %}
                        <img src="{% static 'frontend/assets/img/users/user-01.jpg' %}" alt="profile" class="rounded-circle object-fit-cover w-100 h-100">
                        {% endif %}
                        <label for="id_profile_image" class="position-absolute bottom-0 end-0 bg-primary text-white p-2 rounded-circle cursor-pointer border border-2 border-white" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                            <i class="isax isax-camera fs-14"></i>
                        </label>
                    </div>
                </div>
                <div class="col">
                     <h5 class="mb-1">{{ user.get_full_name|default:user.username }}</h5>
                     <p class="text-muted fs-14 mb-0">{{ user.email }}</p>
                </div>
                 <div class="d-none">
                     {{ form.profile_image }}
                 </div>
            </div>

            <h6 class="text-muted text-uppercase fs-12 fw-bold mb-3 ls-1">Personal Information</h6>
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <label class="form-label fs-14 fw-medium text-dark">First Name</label>
                    {{ form.first_name }}
                    {% if form.first_name.errors %}
                        <div class="text-danger small mt-1">{{ form.first_name.errors.0 }}</div>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <label class="form-label fs-14 fw-medium text-dark">Last Name</label>
                    {{ form.last_name }}
                     {% if form.last_name.errors %}
                        <div class="text-danger small mt-1">{{ form.last_name.errors.0 }}</div>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <label class="form-label fs-14 fw-medium text-dark">Email Address</label>
                    {{ form.email }}
                     {% if form.email.errors %}
                        <div class="text-danger small mt-1">{{ form.email.errors.0 }}</div>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <label class="form-label fs-14 fw-medium text-dark">Phone Number</label>
                    {{ form.phone }}
                     {% if form.phone.errors %}
                        <div class="text-danger small mt-1">{{ form.phone.errors.0 }}</div>
                    {% endif %}
                </div>
                 <div class="col-md-6">
                    <label class="form-label fs-14 fw-medium text-dark">Date of Birth</label>
                    {{ form.date_of_birth }}
                     {% if form.date_of_birth.errors %}
                        <div class="text-danger small mt-1">{{ form.date_of_birth.errors.0 }}</div>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <label class="form-label fs-14 fw-medium text-dark">Nationality</label>
                    {{ form.nationality }}
                     {% if form.nationality.errors %}
                        <div class="text-danger small mt-1">{{ form.nationality.errors.0 }}</div>
                    {% endif %}
                </div>
                 <div class="col-12">
                    <label class="form-label fs-14 fw-medium text-dark">Address</label>
                    {{ form.address }}
                     {% if form.address.errors %}
                        <div class="text-danger small mt-1">{{ form.address.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>

            <hr class="border-dashed my-4">
            
            <h6 class="text-muted text-uppercase fs-12 fw-bold mb-3 ls-1">Security</h6>
            <div class="row g-3 mb-4">
                 <div class="col-md-6">
                    <label class="form-label fs-14 fw-medium text-dark">New Password</label>
                    {{ form.new_password }}
                    <div class="form-text text-muted fs-13">Leave blank if you don't want to change the password.</div>
                     {% if form.new_password.errors %}
                        <div class="text-danger small mt-1">{{ form.new_password.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="d-flex justify-content-end pt-2">
                <button type="submit" class="btn btn-primary rounded-pill px-4">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById('id_profile_image').addEventListener('change', function(event) {
        if (event.target.files && event.target.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                document.querySelector('.avatar-xxl img').src = e.target.result;
            }
            reader.readAsDataURL(event.target.files[0]);
        }
    });
</script>

{% endblock %}