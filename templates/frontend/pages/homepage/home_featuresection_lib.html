{% load static %}
{% load translate_tags %}

{% for feature_section in feature_sections %}
    {% if feature_section.section_tours.exists %}
    <section class="section benifit-section bg-light-200">
        <div class="container">
            <div class="section-header d-flex align-items-center justify-content-between flex-wrap row-gap-3">
                <div>
                    {% if feature_section.short_description or feature_section.short_description_dk %}
                        <p class="mb-2 fw-medium d-flex align-items-center">
                            <span class="text-bar"></span>
                            {% if LANGUAGE_CODE == 'dk' and feature_section.short_description_dk %}
                                {{ feature_section.short_description_dk }}
                            {% else %}
                                {{ feature_section.short_description }}
                            {% endif %}
                        </p>
                    {% endif %}
                    <h2>
                        {% if LANGUAGE_CODE == 'dk' and feature_section.title_dk %}
                            {{ feature_section.title_dk }}
                        {% else %}
                            {{ feature_section.title }}
                        {% endif %}
                        <span class="text-primary">.</span>
                    </h2>
                    {% if feature_section.description or feature_section.description_dk %}
                        <p class="mt-2">
                            {% if LANGUAGE_CODE == 'dk' and feature_section.description_dk %}
                                {{ feature_section.description_dk }}
                            {% else %}
                                {{ feature_section.description }}
                            {% endif %}
                        </p>
                    {% endif %}
                </div>
                <div>
                    <a href="{% url 'tour_feature_section_fronted' feature_section.id %}" class="btn btn-primary">
                        {% translate "View All Tours" %}<i class="isax isax-arrow-right-3 ms-2"></i>
                    </a>
                </div>
            </div>
            
            <div class="place-slider owl-carousel">
                {% for section_tour in feature_section.section_tours.all %}
                    {% with tour=section_tour.tour %}
                        {% if tour.status == 'active' %}
                        <div class="place-item mb-4 flex-fill">
                            <div class="place-img">
                                {% with tour_images=tour.images.all %}
                                    {% if tour_images %}
                                        <div class="img-slider image-slide owl-carousel nav-center">
                                            {% for tour_image in tour_images|slice:":5" %}
                                            <div class="slide-images">
                                                <a href="{% url 'tour_detail' tour.id %}">
                                                    <img src="{{ tour_image.image.url }}" class="img-fluid" alt="{% if LANGUAGE_CODE == 'dk' and tour_image.caption_dk %}{{ tour_image.caption_dk }}{% else %}{{ tour_image.caption|default:tour.title }}{% endif %}"
                                                    style="height: 250px; object-fit: cover;"
                                                    >
                                                </a>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    {% elif tour.main_image %}
                                        <div class="img-slider image-slide owl-carousel nav-center">
                                            <div class="slide-images">
                                                <a href="{% url 'tour_detail' tour.id %}">
                                                    <img src="{{ tour.main_image.url }}" class="img-fluid" alt="{% if LANGUAGE_CODE == 'dk' and tour.title_dk %}{{ tour.title_dk }}{% else %}{{ tour.title }}{% endif %}">
                                                </a>
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="img-slider image-slide owl-carousel nav-center">
                                            <div class="slide-images">
                                                <a href="{% url 'tour_detail' tour.id %}">
                                                    <img src="{% static 'frontend/assets/img/hotels/hotel-01.jpg' %}" class="img-fluid" alt="{% if LANGUAGE_CODE == 'dk' and tour.title_dk %}{{ tour.title_dk }}{% else %}{{ tour.title }}{% endif %}">
                                                </a>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endwith %}
                                
                                <div class="fav-item">
                                    {% if tour.is_featured %}
                                        <span class="badge bg-info d-inline-flex align-items-center">
                                            <i class="isax isax-ranking me-1"></i>{% translate "Featured" %}
                                        </span>
                                    {% elif tour.is_bestseller %}
                                        <span class="badge bg-success d-inline-flex align-items-center">
                                            <i class="isax isax-star me-1"></i>{% translate "Bestseller" %}
                                        </span>
                                    {% endif %}
                                    <a href="javascript:void(0);" class="fav-icon">
                                        <i class="isax isax-heart5"></i>
                                    </a>
                                </div>
                            </div>
                            
                            <div class="place-content">
                                <div class="d-flex align-items-center mb-1">
                                    {% if tour.calculated_average_rating > 0 %}
                                        <span class="badge badge-warning badge-xs text-gray-9 fs-13 fw-medium me-2">{{ tour.calculated_average_rating|floatformat:1 }}</span>
                                        <p class="fs-14">({{ tour.calculated_total_reviews }} {% translate "Reviews" %})</p>
                                    {% else %}
                                        <p class="fs-14 text-muted">{% translate "No reviews yet" %}</p>
                                    {% endif %}
                                </div>
                                
                                <h5 class="mb-1 text-truncate">
                                    <a href="{% url 'tour_detail' tour.id %}">
                                        {% if LANGUAGE_CODE == 'dk' and tour.title_dk %}
                                            {{ tour.title_dk }}
                                        {% else %}
                                            {{ tour.title }}
                                        {% endif %}
                                    </a>
                                </h5>
                                
                                <p class="d-flex align-items-center mb-2">
                                    <i class="isax isax-location5 me-2"></i>
                                    {% if tour.city %}
                                        {% if LANGUAGE_CODE == 'dk' and tour.city.name_dk %}
                                            {{ tour.city.name_dk }}
                                        {% else %}
                                            {{ tour.city.name }}
                                        {% endif %}
                                        {% if tour.city.country %}
                                            , {% if LANGUAGE_CODE == 'dk' and tour.city.country.name_dk %}{{ tour.city.country.name_dk }}{% else %}{{ tour.city.country.name }}{% endif %}
                                        {% endif %}
                                    {% elif tour.destination_region %}
                                        {% if LANGUAGE_CODE == 'dk' and tour.destination_region.name_dk %}
                                            {{ tour.destination_region.name_dk }}
                                        {% else %}
                                            {{ tour.destination_region.name }}
                                        {% endif %}
                                    {% else %}
                                        {% translate "Location not specified" %}
                                    {% endif %}
                                </p>
                                
                                <!-- <div class="border-top pt-2 mb-2">
                                    <h6 class="d-flex align-items-center">
                                        {% translate "Features" %} :
                                        {% if tour.live_guide %}<i class="isax isax-microphone-2 ms-2 me-2 text-primary" title="{% translate 'Live Guide' %}"></i>{% endif %}
                                        {% if tour.skip_the_line %}<i class="isax isax-ticket-discount ms-2 me-2 text-primary" title="{% translate 'Skip the Line' %}"></i>{% endif %}
                                        {% if tour.free_cancellation %}<i class="isax isax-close-circle ms-2 me-2 text-primary" title="{% translate 'Free Cancellation' %}"></i>{% endif %}
                                        {% if tour.wheelchair_accessible %}<i class="isax isax-profile-2user ms-2 me-2 text-primary" title="{% translate 'Wheelchair Accessible' %}"></i>{% endif %}
                                        {% if tour.instant_confirmation %}<i class="isax isax-tick-circle ms-2 me-2 text-primary" title="{% translate 'Instant Confirmation' %}"></i>{% endif %}
                                    </h6>
                                </div> -->
                                
                                <div class="d-flex align-items-center justify-content-between border-top pt-3">
                                    <div>
                                        {% if tour.discount_percentage > 0 %}
                                            <h5 class="text-primary text-nowrap me-2">
                                                {{ tour.base_price }} {{ tour.currency }}
                                                <span class="fs-14 fw-normal text-default">/ {% translate "Person" %}</span>
                                            </h5>
                                            <p class="fs-12 text-muted text-decoration-line-through">
                                                {{ tour.original_price|floatformat:2 }} {{ tour.currency }}
                                            </p>
                                        {% else %}
                                            <h5 class="text-primary text-nowrap me-2">
                                                {{ tour.base_price }} {{ tour.currency }}
                                                <span class="fs-14 fw-normal text-default">/ {% translate "Person" %}</span>
                                            </h5>
                                        {% endif %}
                                    </div>
                                    
                                    {% if tour.supplier %}
                                    <a href="javascript:void(0);" class="d-flex align-items-center overflow-hidden" title="{{ tour.supplier.company_name }}">
                                        <span class="avatar avatar-md flex-shrink-0 me-2">
                                            {% if tour.supplier.logo %}
                                                <img src="{{ tour.supplier.logo.url }}" class="rounded-circle" alt="{{ tour.supplier.company_name }}">
                                            {% else %}
                                                <img src="{% static 'frontend/assets/img/users/user-01.jpg' %}" class="rounded-circle" alt="{{ tour.supplier.company_name }}">
                                            {% endif %}
                                        </span>
                                        <p class="fs-14 text-truncate">{{ tour.supplier.company_name }}</p>
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    {% endwith %}
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}
{% endfor %}
